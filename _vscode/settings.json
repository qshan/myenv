
// This file is ProjectRootPath/.vscode/settings.json
//override the setting in ~/.config/Code/User/settings.json
//
//for coc-clangd local config, this solution need
//   ProjectRootPath/.vscode/settings.json
//   ProjectRootPath/.vscode/extensions.json
//   ProjectRootPath/.clangd
//
{
  "clangd.path": "/usr/bin/clangd", // 确保路径与系统中 clangd 安装位置一致
  "clangd.trace": "verbose",        // 改为 "off" 或 "messages" 减少日志
  "clangd.arguments": [
    "--compile-commands-dir=${workspaceFolder}", // 指定 compile_commands.json 所在目录
    //todo//"--compile-commands-dir=${workspaceFolder}/build",  // 指定 compile_commands.json 目录
    //"--clang-tidy",                 // 启用静态检查
    //todo//"--header-insertion=never",      // 禁止自动插入头文件
    "--malloc-trim",        // 减少内存占用
    "--limit-results=500",   // 限制补全项数量
    //"--target=riscv32",                            // 显式设置目标
    //"--compile-commands-dir=${workspaceFolder}/build", // 替换为你的路径
    //"--log=error",  // 仅显示错误日志
    //"--log=verbose",  // 仅显示错误日志
    //"--clang-tidy=false", //关闭代码检查(按需)
    "--clang-tidy=true", 关闭代码检查（按需）
    "--background-index"  //(后台索引，首次启动较慢，后续增量更新)
  ],
  "clangTidyChecks": "-Wint-to-pointer-cast",
  "files.watcherExclude": {
  "/.cache/": true,
  "/.git/objects/": true,
  "/.git/subtree-cache/": true,
  "/node_modules/*/": true
  },
  //todo//"clangd.checkUpdates": true       // 自动检查 clangd 更新

  //todo// "configurationProvider": "llvm-vs-code-extensions.vscode-clangd"

  //disable ms-vscode.cpptools
  "C_Cpp.intelliSenseEngine": "disabled",   // 禁用 IntelliSense
  "C_Cpp.errorSquiggles": "disabled",       // 禁用错误波浪线
  "C_Cpp.autocomplete": "disabled",         // 禁用自动补全
  "extensions.ignoreRecommendations": true, // 忽略微软扩展的推荐

  // 基础 Vim 优化
  "vim.useCtrlKeys": false,           // 释放 Ctrl 快捷键给 VSCode（如 Ctrl+C/V）
  "vim.handleKeys": {
    "<C-c>": false,                   // 保留复制
    "<C-v>": false,                   // 保留粘贴
    "<C-f>": true,                    // 保留 Vim 的翻页
    "<C-a>": false                    // 保留全选
  },
  "vim.easymotion": true,             // 启用快速跳转（需安装 EasyMotion 插件）
  //"vim.leader": " ",                  // 设置 Leader 键为空格
  "vim.leader": "<space>",
  "vim.useSystemClipboard": true
  // 代码导航：映射 VSCode 命令到 Vim 快捷键
  //"vim.normalModeKeyBindings":
  "vim.normalModeKeyBindingsNonRecursive": [
    // 跳转定义 (gd) - 覆盖默认行为，确保使用 Clangd
    {
      "before": ["g", "d"],
      "commands": ["editor.action.revealDefinition"]
    },
    // 跳转声明 (gD)
    {
      "before": ["g", "D"],
      "commands": ["editor.action.goToDeclaration"]
    },
    {
      "before": ["g", "i"],
      "commands": ["editor.action.goToImplementation"]
    },
    // 查找所有引用
    {
      "before": ["g", "r"],
      //"after": [],
      "commands": [
        {
          //"command": "editor.action.referenceSearch.trigger",
          //"command": "editor.action.showReferences",
          "command": "references-view.find",
          "args": {
            //"position": {"line": 3, "character": 8},
            "position": {"line": -1, "character": -1},
            "includeDeclaration": false,
            "timeout": 3000
            }
        },
      "bench.view.extension.references-view.focus"
      ],
      "when": "editorTextFocus"
    },
    // 回退 (Ctrl+o) - VSCode 的导航历史
    {
      "before": ["<C-o>"],
      "commands": ["workbench.action.navigateBack"]
    },
    // 前进 (Ctrl+i)
    {
      "before": ["<C-i>"],
      "commands": ["workbench.action.navigateForward"]
    },
    // 快速文件搜索 (Leader + p)
    {
      "before": ["<leader>", "p"],
      "commands": ["workbench.action.quickOpen"]
    },
    // 侧边栏切换 (Leader + e)
    {
      "before": ["<leader>", "e"],
      "commands": ["workbench.view.explorer"]
    }
  ],
  "vim.normalModeKeyBindingsNonRecursive": [
    // ========== 代码编辑快捷键 ==========
    // 重命名符号
    {
      "before": ["<leader>", "r", "n"],
      "commands": ["editor.action.rename"]
    },
    // 快速修复
    {
      "before": ["<leader>", "a"],
      "commands": ["editor.action.quickFix"]
    },
    // 格式化文档
    {
      "before": ["<leader>", "f"],
      "commands": ["editor.action.formatDocument"]
    },
    // 格式化选中
    {
      "before": ["<leader>", "F"],
      "commands": ["editor.action.formatSelection"]
    },
    // 展开/折叠代码块
    {
      "before": ["z", "c"],
      "commands": ["editor.fold"]
    },
    {
      "before": ["z", "o"],
      "commands": ["editor.unfold"]
    },
    {
      "before": ["z", "R"],
      "commands": ["editor.unfoldAll"]
    },
    {
      "before": ["z", "M"],
      "commands": ["editor.foldAll"]
    },
    
    // ========== 注释操作 ==========
    {
      "before": ["<leader>", "/"],
      "commands": ["editor.action.commentLine"]
    },
    {
      "before": ["<leader>", "c"],
      "commands": ["editor.action.blockComment"]
    },
    
    // ========== 选择操作 ==========
    {
      "before": ["v", "a", "w"],
      "commands": ["editor.action.smartSelect.expand"]
    },
    {
      "before": ["v", "i", "w"],
      "commands": ["editor.action.smartSelect.shrink"]
    },
    
    // ========== 文件操作 ==========
    {
      "before": ["<leader>", "w"],
      "commands": [":w"]
    },
    {
      "before": ["<leader>", "q"],
      "commands": [":q"]
    },
    {
      "before": ["<leader>", "w", "q"],
      "commands": [":wq"]
    },
    
    // ========== 窗口管理 ==========
    {
      "before": ["<C-w>", "v"],
      "commands": ["workbench.action.splitEditor"]
    },
    {
      "before": ["<C-w>", "s"],
      "commands": ["workbench.action.splitEditorOrthogonal"]
    },
    {
      "before": ["<C-w>", "c"],
      "commands": ["workbench.action.closeActiveEditor"]
    },
    {
      "before": ["<C-w>", "o"],
      "commands": ["workbench.action.closeOtherEditors"]
    },
    {
      "before": ["<C-w>", "h"],
      "commands": ["workbench.action.focusLeftGroup"]
    },
    {
      "before": ["<C-w>", "l"],
      "commands": ["workbench.action.focusRightGroup"]
    },
    {
      "before": ["<C-w>", "j"],
      "commands": ["workbench.action.focusBelowGroup"]
    },
    {
      "before": ["<C-w>", "k"],
      "commands": ["workbench.action.focusAboveGroup"]
    }
  ],
  // 插入模式下保留 VSCode 的建议窗口导航
  "vim.insertModeKeyBindings": [
    {
      "before": ["<C-n>"],
      "after": ["<down>"]  // 下箭头选择建议
    },
    {
      "before": ["<C-p>"],
      "after": ["<up>"]    // 上箭头选择建议
    }
  ]
}
