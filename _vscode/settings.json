
// This file is in ~/.config/Code/User/settings.json
//
//for coc-clangd local config, this solution need
//   ProjectRootPath/.vscode/settings.json
//   ProjectRootPath/.vscode/extensions.json
//   ProjectRootPath/.clangd
//
{

  // ===== VSCodeVim 配置 =====
  "vim.useCtrlKeys": false,
  //"vim.leader": " ", //leader key is space
  "vim.leader": "<space>",
  "vim.easymotion": true,
  "vim.sneak": true,
  "vim.incsearch": true,
  "vim.hlsearch": true,
  "vim.foldfix": true,
  "vim.useSystemClipboard": true,
  "vim.easymotion": true,             // 启用快速跳转（需安装 EasyMotion 插件）

  "vim.handleKeys": {
    "<C-c>": false,                   // 保留Win复制
    "<C-v>": false,                   // 保留Win粘贴
    "<C-a>": false                    // 保留Win全选
    // 释放 VSCode 快捷键
    "<C-b>": false,
    "<C-d>": false,
    "<C-u>": false,
    "<C-y>": false,
    "<C-e>": false,

    "<C-f>": true,                    // 保留 Vim 的翻页
    "<C-o>": true,
    "<C-i>": true,
    "<C-]>": true,
  },

  // ===== UI 渲染控制 =====
  "references.preferredLocation": "view",  // 侧边栏面板
  "references.groupByFile": true,           // 按文件分组
  "editor.gotoLocation.multipleReferences": "peek", // 必须设为 peek 以激活 references-view

  "explorer.compactFolders": false,         // 展开文件夹
  // 代码导航：映射 VSCode 命令到 Vim 快捷键
  //"vim.normalModeKeyBindings":
  "vim.normalModeKeyBindingsNonRecursive": [
    // 跳转定义 (gd) - 覆盖默认行为，确保使用 Clangd
    {
      "before": ["g", "d"],
      "commands": ["editor.action.revealDefinition"],
      "when": "editorTextFocus"
    },
    // 跳转声明 (gD)
    {
      "before": ["g", "D"],
      "commands": ["editor.action.goToDeclaration"],
      "when": "editorTextFocus"
    },
    {
      "before": ["g", "i"],
      "commands": ["editor.action.goToImplementation"],
      "when": "editorTextFocus"
    },
    // 查找所有引用
    {
      "before": ["g", "r"],
      "commands": [
        {
          //"command": "editor.action.referenceSearch.trigger",
          //"command": "editor.action.showReferences",
          "command": "references-view.find",
          "args": {
            "position": {"line": -1, "character": -1},
            "includeDeclaration": false,
            "timeout": 3000
            }
        },
      "bench.view.extension.references-view.focus"
      ],
      "when": "editorTextFocus && !inReferenceSearchEditor"
    },
    // 回退 (Ctrl+o) - VSCode 的导航历史
    {
      "before": ["<C-o>"],
      "commands": ["workbench.action.navigateBack"],
      "when": "editorTextFocus"
    },
     前进 (Ctrl+i)
    {
      "before": ["<C-i>"],
      "commands": ["workbench.action.navigateForward"],
      "when": "editorTextFocus"
    },
    // ===== 函数导航 =====
    {
      "before": ["[", "["],
      "commands": ["cursorMove", { "to": "prevBlankLine" }],
      "when": "editorTextFocus"
    },
    {
      "before": ["]", "]"],
      "commands": ["cursorMove", { "to": "nextBlankLine" }],
      "when": "editorTextFocus"
    },
    // 快速文件搜索 (Leader + p)
    {
      "before": ["<leader>", "p"],
      "commands": ["workbench.action.quickOpen"]
    },
    // 侧边栏切换 (Leader + e)
    {
      "before": ["<leader>", "e"],
      "commands": ["workbench.view.explorer"]
    }
  ],
  "vim.normalModeKeyBindingsNonRecursive": [
    // ========== 代码编辑快捷键 ==========
    // 重命名符号
    {
      "before": ["<leader>", "r", "n"],
      "commands": ["editor.action.rename"]
    },
    // 快速修复
    {
      "before": ["<leader>", "a"],
      "commands": ["editor.action.quickFix"]
    },
    // 格式化文档
    {
      "before": ["<leader>", "f"],
      "commands": ["editor.action.formatDocument"]
    },
    // 格式化选中
    {
      "before": ["<leader>", "F"],
      "commands": ["editor.action.formatSelection"]
    },
    // 展开/折叠代码块
    {
      "before": ["z", "c"],
      "commands": ["editor.fold"]
    },
    {
      "before": ["z", "o"],
      "commands": ["editor.unfold"]
    },
    {
      "before": ["z", "R"],
      "commands": ["editor.unfoldAll"]
    },
    {
      "before": ["z", "M"],
      "commands": ["editor.foldAll"]
    },
    {
      "before": ["z", "a"],
      "commands": ["editor.toggleFold"],
      "when": "editorTextFocus"
    },

    // ========== 注释操作 ==========
    {
      "before": ["<leader>", "/"],
      "commands": ["editor.action.commentLine"]
    },
    {
      "before": ["<leader>", "c"],
      "commands": ["editor.action.blockComment"]
    },
    
    // ========== 选择操作 ==========
    {
      "before": ["v", "a", "w"],
      "commands": ["editor.action.smartSelect.expand"]
    },
    {
      "before": ["v", "i", "w"],
      "commands": ["editor.action.smartSelect.shrink"]
    },
    
    // ========== 文件操作 ==========
    {
      "before": ["<leader>", "w"],
      "commands": [":w"]
    },
    {
      "before": ["<leader>", "q"],
      "commands": [":q"]
    },
    {
      "before": ["<leader>", "w", "q"],
      "commands": [":wq"]
    },
    
    // ========== 窗口管理 ==========
    {
      "before": ["<C-w>", "v"],
      "commands": ["workbench.action.splitEditor"]
    },
    {
      "before": ["<C-w>", "s"],
      "commands": ["workbench.action.splitEditorOrthogonal"]
    },
    {
      "before": ["<C-w>", "c"],
      "commands": ["workbench.action.closeActiveEditor"]
    },
    {
      "before": ["<C-w>", "o"],
      "commands": ["workbench.action.closeOtherEditors"]
    },
    {
      "before": ["<C-w>", "h"],
      "commands": ["workbench.action.focusLeftGroup"]
    },
    {
      "before": ["<C-w>", "l"],
      "commands": ["workbench.action.focusRightGroup"]
    },
    {
      "before": ["<C-w>", "j"],
      "commands": ["workbench.action.focusBelowGroup"]
    },
    {
      "before": ["<C-w>", "k"],
      "commands": ["workbench.action.focusAboveGroup"]
    }
  ],
  // 插入模式下保留 VSCode 的建议窗口导航
  "vim.insertModeKeyBindingsNonRecursive": [
    {
      "before": ["<C-n>"],
      "after": ["<down>"]  // 下箭头选择建议
    },
    {
      "before": ["<C-p>"],
      "after": ["<up>"]    // 上箭头选择建议
    },
    {
      "before": ["<C-space>"],
      "commands": ["editor.action.triggerSuggest"]
    },
    {
      "before": ["<C-]>"],
      "commands": ["editor.action.triggerSuggest"]
    }
  ],
}
